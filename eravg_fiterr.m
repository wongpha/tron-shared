function errs = eravg_fiterr(x);% Modified October 2005 by Chris Asplund%disp(x)%pauseglobal TR global eventsglobal fullhrfbaseline = 0;amplitude = x(2);%    del   del2  disp disp2  ratio  onsp = [x(1)  16  x(4)  1  Inf  x(3)];eventlength = size(events,2);hrf = spm_hrf(TR,p);hrf = hrf/max(hrf)*amplitude;hrf = hrf+baseline;hrf = hrf(1:eventlength)';hrf = repmat(hrf,size(events,1),1);errs = events-hrf;errs = errs(:);errs = errs(~isnan(errs));t = 0:TR:(eventlength-1)*TR;plot(t,hrf(1,:),'b', 'LineWidth', 2);%returnhold onfor e = 1:size(events,1)  plot(t,events(e,:),'co')endtitle(sum(errs.*errs))fullhrf = hrf;hold off